# ğŸš¨ ç·Šæ€¥ä¿®å¾©ï¼šè³‡æ–™åº«å¯«å…¥å•é¡Œ

## å•é¡Œæè¿°
Edge Function ç„¡æ³•å¯«å…¥è³‡æ–™åº«ï¼Œå°è‡´å°è©±è¨˜éŒ„ç®¡ç†é é¢æ²’æœ‰æ–°è³‡æ–™ã€‚

## ä¿®å¾©å…§å®¹
1. **ä¿®æ­£ upsert èªæ³•**ï¼šç§»é™¤ `?on_conflict=session_id&upsert=true` åƒæ•¸
2. **æ·»åŠ è©³ç´°æ—¥èªŒ**ï¼šå¢åŠ  console.log ä¾†è¿½è¹¤å¯«å…¥ç‹€æ…‹
3. **éŒ¯èª¤è™•ç†**ï¼šæ”¹å–„éŒ¯èª¤è™•ç†å’Œç‹€æ…‹æª¢æŸ¥
4. **Prefer æ¨™é ­**ï¼šä½¿ç”¨æ­£ç¢ºçš„ `Prefer` æ¨™é ­æ ¼å¼

## éƒ¨ç½²æ­¥é©Ÿ

### 1. è¤‡è£½ä¿®å¾©å¾Œçš„ä»£ç¢¼
```bash
# è¤‡è£½ scripts/complete-edge-function-fixed.ts çš„å…§å®¹
```

### 2. éƒ¨ç½²åˆ° Supabase
1. å‰å¾€ [Supabase Dashboard](https://supabase.com/dashboard)
2. é¸æ“‡ä½ çš„å°ˆæ¡ˆ
3. å‰å¾€ **Edge Functions** > **claude-chat**
4. è¤‡è£½ `scripts/complete-edge-function-fixed.ts` çš„å…¨éƒ¨å…§å®¹
5. è²¼ä¸Šåˆ°ç·¨è¼¯å™¨ä¸­
6. é»æ“Š **Deploy** æŒ‰éˆ•

### 3. æ¸¬è©¦ä¿®å¾©
```bash
# æ¸¬è©¦è³‡æ–™åº«å¯«å…¥åŠŸèƒ½
node scripts/test-database-write.js

# æª¢æŸ¥å°è©±è¨˜éŒ„
node scripts/check-conversation-records.js
```

## é æœŸçµæœ
- âœ… ç”¨æˆ¶è³‡æ–™æˆåŠŸå¯«å…¥ `user_profiles` è¡¨
- âœ… æœƒè©±è³‡æ–™æˆåŠŸå¯«å…¥ `chat_sessions` è¡¨  
- âœ… æ¶ˆæ¯è³‡æ–™æˆåŠŸå¯«å…¥ `chat_messages` è¡¨
- âœ… ç®¡ç†å¾Œå°é¡¯ç¤ºæ–°çš„å°è©±è¨˜éŒ„

## ç‰ˆæœ¬è³‡è¨Š
- **ç‰ˆæœ¬**ï¼šWEN 1.1.1 - è³‡æ–™åº«å¯«å…¥ä¿®å¾©ç‰ˆ
- **ä¿®å¾©æ—¥æœŸ**ï¼š2025-09-23
- **ä¿®å¾©é¡å‹**ï¼šç·Šæ€¥ä¿®å¾©
