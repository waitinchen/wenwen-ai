# WEN 1.1.4 部署檢查清單

## 📋 版本資訊
- **版本號**: WEN 1.1.4
- **建置編號**: 20250923-006
- **發布日期**: 2025-09-23
- **Git Commit**: admin-backend-query-fix

## 🔧 修復內容

### 1. 管理後台對話記錄查詢問題修復
- ✅ 修正資料庫欄位名稱不匹配問題
  - `client_ip` → `user_ip`
  - `last_active` → `last_activity`
  - 移除不存在的 `last_message_preview` 欄位
- ✅ 添加詳細錯誤日誌
- ✅ 確保管理後台顯示真實資料庫記錄

### 2. 美食查詢推薦錯誤問題修復
- ✅ 添加美食查詢專門邏輯
- ✅ 修復 Fallback 機制過於激進問題
- ✅ 增強 System Prompt 防止 AI 幻覺
- ✅ 確保美食查詢只推薦餐飲美食類別

## 🚀 部署步驟

### Step 1: 部署 Edge Function
1. 前往 Supabase Dashboard > Edge Functions > claude-chat
2. 複製 `scripts/fix-recommendation-logic.ts` 的全部內容
3. 貼上到編輯器中
4. 點擊 Deploy 按鈕

### Step 2: 部署前端
1. 上傳 `dist` 資料夾到正式環境
2. 確認檔案覆蓋成功

### Step 3: 驗證部署
1. **測試前端**: https://ai.linefans.cc
2. **測試管理後台**: https://ai.linefans.cc/admin/login
3. **檢查版本**: 確認顯示 WEN 1.1.4

## 🧪 驗收測試

### 測試 1: 美食查詢推薦
- **測試步驟**: 問「有什麼美食推薦？」
- **預期結果**: 只推薦餐飲美食類別商家，不會推薦教育機構
- **驗證重點**: 不會出現「肯塔基美語是美式餐廳」的幻覺

### 測試 2: 英語學習查詢
- **測試步驟**: 問「我想學英語」
- **預期結果**: 推薦肯塔基美語（教育機構）
- **驗證重點**: 正確推薦教育培訓類別

### 測試 3: 管理後台對話記錄
- **測試步驟**: 登入管理後台 > 對話記錄管理
- **預期結果**: 顯示真實的資料庫記錄，不是模擬數據
- **驗證重點**: 能看到最新的對話記錄

### 測試 4: 停車場查詢
- **測試步驟**: 問「停車資訊」
- **預期結果**: 推薦真實的停車場資料
- **驗證重點**: 推薦停車場類別商家

## 📊 部署後檢查

### 前端檢查
- [ ] 版本號顯示 WEN 1.1.4
- [ ] 聊天功能正常
- [ ] 推薦邏輯正確
- [ ] 無 JavaScript 錯誤

### 管理後台檢查
- [ ] 登入功能正常
- [ ] 對話記錄顯示真實數據
- [ ] 統計數據正確
- [ ] 無查詢錯誤

### Edge Function 檢查
- [ ] 部署成功
- [ ] 環境變數正確
- [ ] 日誌正常
- [ ] API 回應正確

## 🚨 回滾計畫

如果部署後發現問題：
1. 回滾到 WEN 1.1.1 Edge Function
2. 回滾到 WEN 1.1.1 前端版本
3. 檢查錯誤日誌
4. 修復問題後重新部署

## 📝 部署完成確認

- [ ] Edge Function 部署完成
- [ ] 前端部署完成
- [ ] 所有驗收測試通過
- [ ] 版本號確認正確
- [ ] 功能驗證完成

**部署負責人**: C謀
**部署時間**: 2025-09-23
**版本**: WEN 1.1.4
